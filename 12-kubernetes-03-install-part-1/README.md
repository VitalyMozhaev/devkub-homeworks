# Ответы на домашнее задание к занятию "12.3 Развертывание кластера на собственных серверах, лекция 1"
Поработав с персональным кластером, можно заняться проектами. Вам пришла задача подготовить кластер под новый проект.

## Задание 1: Описать требования к кластеру
Сначала проекту необходимо определить требуемые ресурсы. Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

* база данных должна быть отказоустойчивой (не менее трех копий, master-slave) и потребляет около 4 ГБ ОЗУ в работе;
* кэш должен быть аналогично отказоустойчивый, более трех копий, потребление: 4 ГБ ОЗУ, 1 ядро;
* фронтенд обрабатывает внешние запросы быстро, отдавая статику: не более 50 МБ ОЗУ на каждый экземпляр;
* бекенду требуется больше: порядка 600 МБ ОЗУ и по 1 ядру на копию.

Требования: опишите, сколько нод в кластере и сколько ресурсов (ядра, ОЗУ, диск) нужно для запуска приложения. Расчет вести из необходимости запуска 5 копий фронтенда и 10 копий бекенда, база и кеш.

# Ответ:

Состав проекта:
- БД (4 ГБ и 1 ядро) * 3 копии
- Кэш (4 ГБ и 1 ядро) * 3 копии
- Фронтенд (50 МБ и 0,1 ядра) * 5 копий
- Бекенд (600 МБ и 1 ядро) * 10 копий

## Рассчитаем ресурсы для проекта.

```text
Допущения:
Т.к. задача - подготовить кластер под новый проект, предположим, что количество CPU и ОЗУ в задании взяты
исходя из опыта разработчиков, тогда для стабильной работы систем потребуется запас ресурсов.
Кроме того, не определен объём диска для каждого типа системы, поэтому примем следующее:
- БД - как правило, обладает свойством быстро пожирать всё предоставленное место, да ещё и бэкапы, поэтому
выделим под каждый инстанс 100 ГБ.
- Кэш - это по сути подготовленные данные, которые обычно хранятся в оперативной памяти, а не на диске
(на диске выделяется двойной объём ОЗУ для подкачки), поэтому выделим под каждый инстанс 20 ГБ
- Фронтенд - содержит небольшой объём данных и, учитывая требуемое кол-во ОЗУ, выделим под каждый инстанс 20 ГБ
- Бекенд - как правило, бэкенд не имеет больших объёмов, поэтому выделим под каждый инстанс 20 ГБ
```

| Состав проекта: | CPU, ядра | ОЗУ, ГБ | Диск, ГБ | Кол-во инстансев | Итого CPU, ядра | Итого ОЗУ, ГБ | Диск, ГБ |
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
| БД | 1 | 4 | 100 | 3 копии | 3 | 12 | 300 |
| Кэш | 1 | 4 | 20 | 3 копии | 3 | 12 | 60 |
| Фронтенд | 0,1 | 0,05 | 20 | 5 копий | 1 (округлим до целого) | 1 | 100 |
| Бекенд | 1 | 0,6 | 20 | 10 копий | 10 | 6 | 200 |
|  |  |  | **Итого** | 21 инстанс | 17 | 31 | 660 |

## Требования к серверам:

### Требования для Control Plain:
- CPU - 2
- ОЗУ - 2 ГБ (лучше 4 ГБ, чтобы нормально функционировала ETCD)
- Диск - 50 ГБ

### Требования для рабочей ноды:
- CPU - 1
- ОЗУ - 1 ГБ
- Диск - 100 ГБ

Для нового проекта будет достаточно `одной управляющей ноды (Control Plain)`.
При необходимости можно будет развернуть дополнительные, либо вынести ETCD в отдельный кластер.

А вот с рабочими нодами не так однозначно.
Если одна из нод упадёт, на других нодах должно быть достаточно ресурсов, чтобы развернуть все инстансы с упавшей ноды.
Учитывая это, логично использовать большее кол-во нод, чтобы в случае отказа одной ноды перераспределять меньшее кол-во инстансов.
Учитывая эти моменты, `разумно использовать 7 нод`.

```text
21 инстанс / 7 нод = по 3 инстанса на ноду + резерв для перераспределения.
Получаем по 4 инстанса на каждую из семи нод.
```

### Рассчитаем ресурсы для рабочей ноды:

Настройки Kubernetes позволяют запрещать размещение одинаковых подов на одной ноде. Таким образом, например, две БД не смогут разместиться на одной ноде.
Будем считать, что на каждой ноде могут разместиться, например, только 1 БД или только 1 КЭШ и любые другие лёгкие инстансы + резерв для перераспределения 1 инстанса.

Получаем для каждой из 7-ми рабочих нод следующую нагрузку:
- CPU - 4 ядра (+ 1 ядро сама нода) = 5 ядер
- ОЗУ - 7 ГБ (+ 1 ГБ сама нода) = 8 ГБ
- Диск - 200 ГБ (+ 100 ГБ сама нода) = 300 ГБ

---

Для всех 7 рабочих нод:
- CPU - 35
- ОЗУ - 56 ГБ
- Диск - 2100 ГБ

И помним о Control Plain:
- CPU - 2
- ОЗУ - 4 ГБ
- Диск - 50 ГБ

Учитывая размытые параметры задания `не менее трех копий` и `более трех копий`, запас получился хороший.

Разворачивать всё это желательно в облаке, если позволяет специфика деятельности предприятия.
Дальше нужно взять проект-менеджера, владельца или заказчика и хорошенько объяснить и обосновать, для какой
такой стабильности и отказоустойчивости нужно такое финансирование под этот проект. )))
Если финансирование не одобрят, придётся ужиматься до минимума, что крайне не желательно.



